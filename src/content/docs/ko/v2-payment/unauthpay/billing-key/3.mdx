---
title: 3. 빌링키 결제 API 구현하기 (서버)
description: 포트원 빌링키 결제 API를 사용해 가맹점의 빌링키 결제 요청 API를 구현합니다.
---

import Tabs from "~/components/gitbook/tabs/Tabs.astro";
import Tab from "~/components/gitbook/tabs/Tab.astro";


예시를 위해 경로가 `/billings`인 빌링키 결제 요청 API를 구현합니다.

이 API는 내부적으로 포트원의 빌링키 결제 API를 호출하며, 결제창 혹은 API를 통해 발급된 빌링키를 이용해 실제 결제를 진행합니다.

<Tabs>
  <Tab title="Express.js">
    ```javascript
    // bodyParser 등을 통해 body의 JSON 데이터를 파싱할 수 있는지 확인해주세요.
    app.use(bodyParser.json());
    // POST 요청을 받는 /billings
    app.post("/billings", async (req, res) => {
      try {
        // 요청의 body로 빌링키가 오기를 기대합니다.
        const { billingKey } = req.body;

        // 1. 포트원 API를 사용하기 위해 액세스 토큰을 발급받습니다.
        const signinResponse = await fetch("https://api.portone.io/signin/api-secret", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ apiSecret: PORTONE_API_SECRET }),
        });
        if (!signinResponse.ok) throw new Error(`signinResponse: ${signinResponse.statusText}`);
        const { accessToken } = await signinResponse.json();

        // 가맹점에서 채번하는 새로운 결제 ID를 만들어주세요.
        const paymentId = OrderService.newPaymentId();

        // 2. 포트원 빌링키 결제 API 호출
        const paymentResponse = await fetch(
          `https://api.portone.io/payments/${encodeURIComponent(paymentId)}/billing-key/pay`,
          {
            method: "POST",
            // 1번에서 발급받은 액세스 토큰을 Bearer 형식에 맞게 넣어주세요.
            headers: { "Authorization": `Bearer ${accessToken}` },
            body: JSON.stringify({
              billingKey,
              orderName: "월간 이용권 정기결제",
              amount: {
                total: 8900,
              },
              // 빌링키 결제 API를 참고해 고객 정보를 채워주세요.
              customer: YOUR_CUSTOMER_INFO,
              currency: "KRW",
            }),
          },
        );
        if (!paymentResponse.ok) throw new Error(`paymentResponse: ${paymentResponse.statusText}`);
      } catch (e) {
        // 빌링키 결제에 실패했습니다.
        res.status(400).send(e);
      }
    });
    ```

  </Tab>
</Tabs>
